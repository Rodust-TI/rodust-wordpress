document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector("[data-mobile-menu-toggle]");let t=document.querySelector("[data-mobile-menu]");e&&t&&e.addEventListener("click",function(){t.classList.toggle("hidden")}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();e=this.getAttribute("href").substring(1),e=document.getElementById(e);e&&e.scrollIntoView({behavior:"smooth"})})});let n=document.getElementById("user-menu-button"),o=document.getElementById("user-dropdown"),s=(n&&o&&(n.addEventListener("click",function(e){e.stopPropagation(),o.classList.toggle("hidden")}),document.addEventListener("click",function(e){n.contains(e.target)||o.contains(e.target)||o.classList.add("hidden")})),document.getElementById("user-menu-button-mobile")),d=document.getElementById("user-dropdown-mobile");s&&d&&(s.addEventListener("click",function(e){e.stopPropagation(),d.classList.toggle("hidden")}),document.addEventListener("click",function(e){s.contains(e.target)||d.contains(e.target)||d.classList.add("hidden")}));var e=document.getElementById("logout-button"),e=(e&&e.addEventListener("click",function(e){e.preventDefault(),sessionStorage.removeItem("customer_token"),sessionStorage.removeItem("customer_data"),localStorage.removeItem("cart");var e=document.getElementById("cart-count-badge"),t=document.getElementById("cart-count-badge-mobile");e&&e.classList.add("hidden"),t&&t.classList.add("hidden"),window.location.href="/"}),document.getElementById("logout-button-mobile")),e=(e&&e.addEventListener("click",function(e){e.preventDefault(),sessionStorage.removeItem("customer_token"),sessionStorage.removeItem("customer_data"),localStorage.removeItem("cart");var e=document.getElementById("cart-count-badge"),t=document.getElementById("cart-count-badge-mobile");e&&e.classList.add("hidden"),t&&t.classList.add("hidden"),window.location.href="/"}),e=null!==sessionStorage.getItem("customer_token"),r=document.getElementById("user-logged-in-menu"),i=document.getElementById("user-logged-out-menu"),r&&i&&(e?(r.classList.remove("hidden"),i.classList.add("hidden")):(r.classList.add("hidden"),i.classList.remove("hidden"))),r=document.getElementById("user-logged-in-menu-mobile"),i=document.getElementById("user-logged-out-menu-mobile"),r&&i&&(e?(r.classList.remove("hidden"),i.classList.add("hidden")):(r.classList.add("hidden"),i.classList.remove("hidden"))),document.getElementById("search-toggle-button"));let c=document.getElementById("search-modal"),a=document.getElementById("global-search-input");var r=document.getElementById("close-search-modal"),i=document.getElementById("search-backdrop");let l=document.getElementById("search-results"),u;function m(){c&&(c.classList.add("hidden"),a.value="",l.innerHTML='<p class="text-gray-500 text-sm">Digite para buscar produtos...</p>')}e&&c&&(e.addEventListener("click",function(){c.classList.remove("hidden"),a.focus()}),r&&r.addEventListener("click",m),i&&i.addEventListener("click",m),document.addEventListener("keydown",function(e){"Escape"!==e.key||c.classList.contains("hidden")||m()}),a)&&a.addEventListener("input",function(){clearTimeout(u);let e=this.value.trim();e.length<3?l.innerHTML='<p class="text-gray-500 text-sm">Digite pelo menos 3 caracteres...</p>':(l.innerHTML='<p class="text-gray-500 text-sm">Buscando...</p>',u=setTimeout(()=>{var n;n=e,fetch(window.RODUST_API_URL+"/api/products?search="+encodeURIComponent(n)).then(e=>e.json()).then(e=>{if(e.products&&0!==e.products.length){let t='<div class="space-y-3">';e.products.slice(0,5).forEach(e=>{t+=`
                        <a href="/produto/${e.slug}" class="flex items-center gap-4 p-3 hover:bg-gray-50 rounded-lg transition-colors">
                            <img src="${e.image||"/placeholder.jpg"}" alt="${e.name}" class="w-16 h-16 object-cover rounded">
                            <div class="flex-1">
                                <h4 class="font-semibold text-gray-900">${e.name}</h4>
                                <p class="text-blue-600 font-bold">R$ ${parseFloat(e.price).toFixed(2).replace(".",",")}</p>
                            </div>
                        </a>
                    `}),t+="</div>",5<e.products.length&&(t+=`<div class="mt-4 pt-4 border-t text-center">
                        <a href="/produtos?search=${encodeURIComponent(n)}" class="text-blue-600 hover:text-blue-800">
                            Ver todos os ${e.products.length} resultados
                        </a>
                    </div>`),l.innerHTML=t}else l.innerHTML='<p class="text-gray-500 text-sm">Nenhum produto encontrado.</p>'}).catch(e=>{console.error("Erro na busca:",e),l.innerHTML='<p class="text-red-500 text-sm">Erro ao buscar. Tente novamente.</p>'})},500))}),(e=sessionStorage.getItem("customer_token"))&&fetch(window.RODUST_API_URL+"/api/wishlist",{method:"GET",headers:{Authorization:"Bearer "+e,Accept:"application/json"},credentials:"include"}).then(e=>e.json()).then(e=>{var e=e.wishlist?e.wishlist.length:0,t=document.getElementById("wishlist-count-badge");t&&(0<e?(t.textContent=e,t.classList.remove("hidden")):t.classList.add("hidden"))}).catch(e=>console.error("Erro ao carregar wishlist count:",e))});